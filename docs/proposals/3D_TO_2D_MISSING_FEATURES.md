# 3D表示バージョンで実装済み・2D表示バージョンで未実装の機能一覧

## 概要
このドキュメントは、3D表示バージョン（`Scene.tsx`）で実装されているが、2D表示バージョン（`Scene2DPixi.tsx`）で未実装の機能を一覧化したものです。

## 未実装機能一覧

### 1. フォグ（Fog）システム
**3D版の実装**: `Scene.tsx` の `getFogDensity()` 関数と `FogExp2`
- **機能**: 深度と感情分布に応じてフォグの密度を動的に計算
- **詳細**:
  - 深度が深いほどフォグが濃くなる（基本密度）
  - 強い感情が多いほど霧が薄くなる（感情が「空間を切り開く」）
  - 感情オブジェクトが少ない深度では霧が濃くなる
  - 地表付近（深度-10～10）での急激な変化
  - 地上エリア（深度10-100）では非常に薄いフォグ
  - 地下エリアでは深いほど濃いフォグ
- **2D版での実装方法**: PixiJSのフィルターやパーティクルシステムを使用して視覚的なフォグ効果を実現

### 2. ライティングシステム
**3D版の実装**: `Scene.tsx` の `getLightingSettings()` 関数と `ambientLight` / `directionalLight`
- **機能**: 感情分布に応じて環境光と指向性ライトの強度・色を動的に調整
- **詳細**:
  - 環境光の強度調整（joy/inspirationが多いと明るく、sadnessが多いと暗く）
  - 指向性ライトの強度と色の調整（感情タイプに応じて色が変化）
  - stressが多い場合の点滅効果（0.5秒周期）
  - 地表付近での急激な明るさの変化
  - 地上エリアでは明るいライティング（太陽光のような感じ）
- **2D版での実装方法**: 背景色やオブジェクトの明るさを動的に調整し、視覚的なライティング効果を実現

### 3. カメラ制御
**3D版の実装**: `Scene.tsx` の `useFrame` 内でのカメラ位置・回転の制御
- **機能**: 深度に応じたカメラの位置と回転をスムーズに制御
- **詳細**:
  - 深度に応じたカメラ位置のスムーズな補間（Lerp、補間係数0.1）
  - 地上エリア（depth <= 10）でのカメラの下向き傾き（約8.6度、tiltAngle = -0.15）
  - 地下エリアでは正面を見る（rotation.x = 0）
- **2D版での実装方法**: 2Dではカメラの概念がないため、オブジェクトの位置やスケールを調整して視覚的な深度感を表現

### 4. 地表平面（SurfacePlane）
**3D版の実装**: `SurfacePlane.tsx` コンポーネント
- **機能**: 深度0（y=0）に配置され、地上と地下を視覚的に分離する透明な平面
- **詳細**:
  - カスタムシェーダーマテリアルによるガラスのような青白い色
  - 深度に応じた透明度の調整（地表に近いほど不透明）
  - フレネル効果（端がより明るく見える）
  - 時間に応じた微細な揺らぎ（水面のような効果）
- **2D版での実装方法**: PixiJSのGraphicsで透明な線やグラデーションを描画して視覚的な分離を表現

### 5. テラリウム（Terrarium）
**3D版の実装**: `Terrarium.tsx` コンポーネント
- **機能**: 地上エリアに配置される過去のチャット内容に基づいて成長する植物システム
- **詳細**:
  - 過去のチャットデータ（`getStrataObjects`）を分析
  - 各感情タイプの分布から植物の成長度合いを計算
  - 感情タイプごとの専用植物コンポーネント（JoyPlant, PeacePlant, StressPlant等）
  - 成長度合い（growthProgress: 0-1）に応じた植物の表示
- **2D版での実装方法**: PixiJSで植物を2Dスプライトとして描画し、成長度合いに応じてスケールやアニメーションを調整

### 6. 星屑や光の粒（Sparkles）
**3D版の実装**: `Scene.tsx` の `Sparkles` コンポーネント（`@react-three/drei`）
- **機能**: 複数レイヤーの星屑エフェクトで空間に深みを与える
- **詳細**:
  - 第1レイヤー: 200個、スケール[100, 200, 100]、サイズ2、速度0.4、不透明度0.6
  - 第2レイヤー: 150個、スケール[150, 300, 150]、サイズ1.5、速度0.3、不透明度0.4、色#a0a0ff
  - 第3レイヤー: 100個、スケール[200, 400, 200]、サイズ1、速度0.2、不透明度0.3、色#6666ff
  - 各レイヤーは深度に応じて位置が調整される
- **2D版での実装方法**: PixiJSのパーティクルシステム（ParticleContainer）を使用して星屑エフェクトを実現

### 7. 植物システム（PlantSystem）
**3D版の実装**: `ecosystem/PlantSystem.tsx` コンポーネント
- **機能**: 感情オブジェクトから植物を生成するシステム
- **詳細**:
  - 地上エリア: 全感情オブジェクトの分布から均等に配置
  - 地下エリア: 現在の深度±800の範囲内の感情オブジェクトの周囲に生成
  - 感情タイプごとの専用植物コンポーネント（JoyPlant, PeacePlant等）
  - 感情オブジェクトの強度に応じた植物のサイズと配置
- **2D版での実装方法**: PixiJSで植物を2Dスプライトとして描画し、感情オブジェクトの位置に配置

### 8. 生物システム（CreatureSystem）
**3D版の実装**: `ecosystem/CreatureSystem.tsx` コンポーネント
- **機能**: 感情オブジェクトから生物を生成するシステム
- **詳細**:
  - 地上エリア: 全感情オブジェクトの分布から均等に配置
  - 地下エリア: 現在の深度±800の範囲内の感情オブジェクトの周囲に生成
  - 感情タイプごとの専用生物コンポーネント（LightButterfly, WaterBubble, EnergyParticle, MemoryFragment, LostLight）
  - 感情オブジェクトの強度に応じた生物の配置
- **2D版での実装方法**: PixiJSで生物を2Dスプライトとして描画し、アニメーションを追加

### 9. 感情分布の分析と環境への反映（一部未実装）
**3D版の実装**: `Scene.tsx` の `analyzeAllEmotionDistribution()` と `analyzeEmotionDistribution()` 関数
- **機能**: 感情オブジェクトの分布を分析し、環境（背景色、フォグ、ライティング）に反映
- **詳細**:
  - 全感情オブジェクトの分布分析（地上エリア用）
  - 近くの感情オブジェクトの分布分析（地下エリア用、±800の範囲）
  - 背景色への感情の影響（現在2D版では実装されていない）
  - フォグ密度への感情の影響（未実装）
  - ライティングへの感情の影響（未実装）
- **2D版での実装状況**: 背景色の計算は実装済みだが、感情分布の影響は未実装

### 10. 他者の光（OthersLight）の高度な表現
**3D版の実装**: `OthersLight.tsx` コンポーネント
- **機能**: 他者の存在を示す「遠くの光」を3D空間で表現
- **詳細**:
  - カテゴリに応じた色の設定
  - 強度に応じた不透明度とサイズの調整
  - ゆっくりと点滅するアニメーション（0.5秒周期）
  - 周囲を照らすポイントライト（非常に弱い）
  - 3D空間での位置と表現
- **2D版での実装状況**: 基本的な光の描画は実装済みだが、点滅アニメーションやライト効果は未実装

### 11. 地上エリアと地下エリアの判定と処理分岐
**3D版の実装**: `Scene.tsx` の `isSurfaceArea` 判定とそれに応じた処理分岐
- **機能**: 深度に基づくエリア判定とそれに応じた処理の分岐
- **詳細**:
  - 深度0以上～100以下が地上エリア、100より大きい値が地下エリア
  - 地上エリアでは全感情オブジェクトの分布を分析
  - 地下エリアでは近くの感情オブジェクトのみを分析
  - 地上エリアでは明るいライティング、地下エリアでは暗いライティング
  - 植物システムと生物システムの表示条件が異なる
- **2D版での実装状況**: エリア判定は実装されていない（背景色の計算で深度100を境界としているが、処理分岐は未実装）

### 12. 感情オブジェクトのインタラクション
**3D版の実装**: `emotions/EmotionObject.tsx` の `EmotionObjectRenderer` コンポーネント
- **機能**: 感情オブジェクトのホバー/クリック検出とインタラクション
- **詳細**:
  - マウス/タッチイベントの検出（Raycasterを使用）
  - ホバー時の視覚的フィードバック
  - クリック時の詳細モーダル表示（`EmotionDetailModal`）
  - `useInteractionStore` を使用した状態管理
- **2D版での実装方法**: PixiJSのインタラクティブ機能（`interactive = true`, `on('pointerdown')`等）を使用して実装

### 13. 背景色への感情分布の影響
**3D版の実装**: `Scene.tsx` の `getBackgroundColor()` 関数（現在はコメントアウトされているが、ロジックは存在）
- **機能**: 深度と感情分布に応じて背景色を計算（感情の影響を10%に制限）
- **詳細**:
  - joy/inspiration: 暖色（黄色・オレンジ）の影響
  - sadness/peace: 青緑色の影響
  - stress: 赤・紫の影響
  - nostalgia: セピア色の影響
  - confusion: 濁った緑の影響
  - 白っぽい色にならないように制限（r, g, b がすべて150以上にならない）
- **2D版での実装状況**: 背景色の計算は実装済みだが、感情分布の影響は未実装

## 実装済み機能（2D版）

以下の機能は2D版でも実装されています：

1. **背景色の計算**: 深度に応じた背景色の計算（地上と地下を分離）
2. **地面の描画**: 深度に応じた地面の位置とスクロール
3. **感情オブジェクトの描画**: PixiJSを使用した2Dスプライトとしての描画
4. **他者の光の描画**: 基本的な光の描画（点滅アニメーションは未実装）

## 優先度の提案

### 高優先度
1. **感情オブジェクトのインタラクション** - ユーザー体験に直接影響
2. **地上エリアと地下エリアの判定と処理分岐** - 基本的な機能の完成度向上
3. **背景色への感情分布の影響** - 環境への感情の反映という核心機能

### 中優先度
4. **星屑や光の粒（Sparkles）** - 視覚的な深みと雰囲気の向上
5. **他者の光（OthersLight）の点滅アニメーション** - 視覚的なフィードバックの向上
6. **植物システム（PlantSystem）** - エコシステムの一部として重要

### 低優先度
7. **生物システム（CreatureSystem）** - エコシステムの拡張
8. **テラリウム（Terrarium）** - 地上エリア専用の機能
9. **フォグ（Fog）システム** - 2Dでは視覚的な効果が限定的
10. **ライティングシステム** - 2Dでは背景色の調整で代替可能
11. **地表平面（SurfacePlane）** - 2Dでは視覚的な分離が限定的
12. **カメラ制御** - 2Dでは不要（オブジェクトの位置調整で代替）

## 備考

- 2D版では3D版の一部の機能が視覚的に表現しにくいため、代替手段を検討する必要があります
- PixiJSの機能を活用することで、多くの3D機能を2Dで再現可能です
- パフォーマンスを考慮して、必要に応じて機能を簡略化することも検討してください

